<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Editor.js</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <style>
      .container {
        margin-top: 70px;
        flex-direction: row;
        justify-content: flex-start;
        align-items: flex-start;
        flex-wrap: wrap;
        align-content: flex-start;
      }
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
      .bd-placeholder-img-footer {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }
      .dropdown-toggle {
        border: none;
      }
      .dropend {
        border: none;
        position: fixed;
      }
      div.scrollmenu {
        background-color: #333;
        overflow: auto;
        white-space: nowrap;
      }

      div.scrollmenu a {
        display: inline-block;
        
        text-align: center;
        padding: 14px;
        text-decoration: none;
      }

      div.scrollmenu a:hover {
        background-color: #777;
      }

      /* sidebar dropdown 的部分 */
      /* Fixed sidenav, full height */
      .sidenav {
        height: 100%;
        width: 200px;
        position: fixed;
        z-index: 1;
        top: 0;
        left: 0;
        background-color: #111;
        overflow-x: hidden;
        padding-top: 20px;
      }

      /* Style the sidenav links and the dropdown button */
      .sidenav a,
      .dropdown-btn {
        padding: 6px 8px 6px 16px;
        text-decoration: none;
        font-size: 20px;
        color: #818181;
        display: block;
        border: none;
        background: none;
        width: 100%;
        text-align: left;
        cursor: pointer;
        outline: none;
      }

      /* On mouse-over */
      .sidenav a:hover,
      .dropdown-btn:hover {
        color: #f1f1f1;
      }

      /* Main content */
      .main {
        margin-left: 200px; /* Same as the width of the sidenav */
        font-size: 20px; /* Increased text to enable scrolling */
        padding: 0px 10px;
      }

      /* Add an active class to the active dropdown button */
      .active {
        color: white;
      }

      /* Dropdown container (hidden by default). Optional: add a lighter background color and some left padding to change the design of the dropdown content */
      .dropdown-container {
        display: none;
        background-color: #262626;
        padding-left: 8px;
      }

      /* Optional: Style the caret down icon */
      .fa-caret-down {
        float: right;
        padding-right: 8px;
      }
      #editorjs {
        margin-top: 100px;
      }
      /*  */
      /* sidebar 縮放功能 */
    </style>
  </head>
  <body>
    <%- include("components/header")%>

    <script src="https://cdn.jsdelivr.net/npm/@editorjs/editorjs@latest"></script>

    <div id="editorjs" class="m-4 bg-light bg-gradient vh-100">HI IM test2</div>
    <button>Save Article</button>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/header@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/link@2.3.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/list@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/raw"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/simple-image@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/checklist@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/embed@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/quote@latest"></script>
    <script>
      console.log("Hi");
      const editor = new EditorJS({
        tools: {
          header: Header,
          // 缺 link tool
          linkTool: {
            class: LinkTool,
            config: {
              endpoint: "http://localhost:8008/fetchUrl", // Your backend endpoint for url data fetching
            },
          },
          raw: RawTool,
          image: {
            class: SimpleImage,
            inlineToolbar: ["link"],
          },
          // 缺 Image Tool
          checklist: {
            class: Checklist,
            inlineToolbar: true,
          },
          list: {
            class: List,
            inlineToolbar: ["link", "bold"],
          },
          embed: Embed,
          quote: Quote,
          // 還有更多工具在 https://github.com/editor-js
        },
      });
      console.log({ holder: "editorjs" });
    </script>
    <%- include("components/footer")%>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
    <script>
      const url = "/user/profileAuth";
      const token = localStorage.getItem("accessToken");
      let user;
      fetch(url, {
        method: "GET",
        headers: {
          Authorization: "Bearer " + token,
        },
      })
        .then((res) => res.json())
        .then((res) => {
          if (res.error) {
            alert("請先登入");
            self.location.href = "/user/sign";
          }
          console.log(res);
          user = res;
        })
        .catch((err) => {
          console.log(err);
          alert("請先登入");
          self.location.href = "/user/sign";
        });

      const btn = document.querySelector(".newArticle");
      btn.addEventListener("click", async (e) => {
        console.log("btn clicked");
        const url = "/articles/newmd";

        const elements = document.getElementById("articleForm").elements;
        let data = {};
        for (var i = 0; i < elements.length; i++) {
          var item = elements.item(i);
          data[item.name] = item.value;
        }
        data.user = user;
        data = await JSON.stringify(data);

        console.log("-1");
        console.log(data);
        console.log("token: " + token);
        fetch(url, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: "Bearer " + token,
          },
          body: data,
        })
          .then(function (response) {
            // const resJson = await res.json();
            return response.text();
          })
          .then(function (data) {
            console.log(data);
            alert("文章上傳成功");
            self.location.href = `/articles/${data}`;
          })
          .catch((e) => {
            console.log("error");
            console.log(e);
          });
      });
    </script>
  </body>
</html>
